# PlanCraft AI 에이전트 시스템 분석 보고서

## 1. 시스템 개요
PlanCraft는 LangGraph가 조율하는 **계층적 다중 에이전트 아키텍처(Hierarchical Multi-Agent Architecture)**를 활용합니다. 전문적인 사업 기획서 작성을 위해 `계획-사용-실행(Plan-and-Execute)` 패턴과 `인간 참여형(HITL, Human-in-the-Loop)` 기능을 결합했습니다.

### 핵심 철학
- **관심사의 분리 (Separation of Concerns)**: 각 에이전트는 구조 설계, 집필, 검토, 분석 등 명확하고 전문화된 역할을 수행합니다.
- **동적 적응성 (Dynamic Adaptability)**: 사용자 의도(IT vs 비IT)와 품질 프리셋(빠른 생성 vs 고품질)에 따라 시스템 동작이 유연하게 변경됩니다.
- **견고성 (Robustness)**: 재시도(Retry), 대체 로직(Fallback), 인간 개입 지점을 통해 시스템 안정성을 확보합니다.

---

## 2. 에이전트 구성 및 역할

### 🧠 지휘자: `NativeSupervisor` (슈퍼바이저)
- **역할**: 전체 실행 계획을 수립하고 하위 전문 에이전트들을 지휘하는 중앙 두뇌입니다.
- **주요 기능**:
  - **동적 라우팅**: 입력 내용에 따라 필요한 에이전트를 결정합니다. (예: 앱 기획이면 `Tech Agent`, SNS 마케팅이면 `Content Agent` 추가)
  - **DAG 실행 관리**: 의존성이 없는 에이전트(시장, BM 분석)는 병렬로, 의존성이 있는 에이전트(재무 분석 등)는 순차적으로 실행합니다.
  - **적응형 컨텍스트 주입**: 상황에 맞는 지침(예: "심층 분석 모드", "사후 부검 분석")을 에이전트에게 하달합니다.

### 🏗️ 설계자: `Structurer` (구조화 에이전트)
- **역할**: 기획서의 상세 목차(TOC)와 뼈대를 설계합니다.
- **능력**:
  - **프리셋 기반 설계**:
    - **Fast 모드**: MVP 아이디어 검증을 위한 5~7개의 핵심 섹션 설계.
    - **Quality 모드**: 13개 이상의 섹션을 포함하는 종합적이고 상세한 구조 설계.
  - **자가 교정**: 출력 전 섹션 개수가 설정된 기준을 충족하는지 스스로 검증합니다.

### ✍️ 작가: `Writer` (집필 에이전트)
- **역할**: RAG(지식 베이스) 및 웹 검색 데이터를 활용하여 실제 섹션별 본문을 작성합니다.
- **능력**:
  - **초개인화**: 분석 컨텍스트에 맞춰 어조와 깊이를 조절합니다.
  - **시각적 사고**: Mermaid 다이어그램 및 ASCII 차트를 생성하여 시각적 이해를 돕습니다.
  - **팩트 기반**: 신뢰성 확보를 위해 웹 검색 출처를 엄격하게 인용합니다.

### 🕵️ 전문가 그룹 (Specialists)
슈퍼바이저의 지휘 아래 심층 도메인 지식을 제공하는 에이전트들입니다.

1.  **`Market Agent` (시장 분석가)**
    - TAM/SAM/SOM 시장 규모 추정 및 경쟁사 비교 테이블 작성.
2.  **`BM Agent` (비즈니스 전략가)**
    - 수익 모델 설계, 가격 정책 수립, 경쟁 우위(Moat) 전략 제시.
3.  **`Financial Agent` (CFO 페르소나)**
    - **표준**: 기본적인 수익/비용 추정.
    - **Quality 모드**: **Best/Normal/Worst 시나리오 분석** 및 월별 추정 손익계산서 작성.
4.  **`Risk Agent` (리스크 매니저)**
    - **표준**: 기본적인 SWOT 분석.
    - **Quality 모드**: **Pre-mortem(사전 부검) 분석** (프로젝트 실패를 가정하고 원인을 역추적) 및 컨틴전시 플랜 수립.
5.  **`Tech Agent` (적응형 구현 전문가)** - *최근 업그레이드됨*
    - **IT 프로젝트**: 시스템 아키텍처, DB 스키마, API 명세 생성.
    - **비IT 프로젝트**: **운영 계획(Operations Plan)**으로 자동 전환되어 매장 배치도, 인력 운영 스케줄 생성.

### ⚖️ 비평가: `Reviewer` (검토 에이전트)
- **역할**: 작성된 초안을 엄격한 품질 기준에 따라 평가합니다.
- **능력**:
  - **점수 시스템**: 문서를 0~10점으로 평가하여 통과 여부를 결정합니다.
  - **행동 유도 피드백**: `Refiner`(수정 모드의 작가)가 문서를 개선할 수 있도록 구체적인 수정 지침을 제공합니다.

---

## 3. 최근 주요 개선 사항 (High-Quality 프로젝트)

### A. 적응형 구현 모드 (Adaptive Implementation Mode)
- **문제**: 기존 `Tech Agent`는 무조건 IT 스펙만 생성하여 오프라인 사업 기획 시 무용지물이었습니다.
- **해결**: `Supervisor`에 프로젝트 유형 감지 로직 추가.
  - **효과**: 빵집 창업 기획서의 경우 "서버 아키텍처" 대신 "주방 설비 배치 및 제빵 스케줄"을 생성하도록 개선되었습니다.

### B. High-Quality "심층 분석(Deep Dive)" 모드
- **문제**: 고품질 모드가 단순히 분량만 늘리는 수준이었습니다.
- **해결**:
  - **양적 개선**: 최소 섹션 수 상향 (10개 -> 13개).
  - **질적 개선**:
    - **재무**: 시나리오 플래닝(Scenario Planning) 기법 도입.
    - **리스크**: 프리모텀(Pre-mortem) 프레임워크 도입.
    - **시장**: 3개 이상 경쟁사 심층 비교 분석 강제.

### C. 로직 교정
- `Structurer` 프롬프트에 하드코딩되어 있던 섹션 수 제한을 제거하고, 프리셋 설정에 따라 유동적으로 확장되도록 수정했습니다.

---

## 4. 기술적 아키텍처 효율성

### LangGraph 통합
- **상태 관리**: `PlanCraftState`를 통해 컨텍스트를 불변(Immutable) 상태로 관리하며 에이전트 간 전달합니다.
- **인터럽트**: `option_pause_node`를 통해 상태 손실 없이 안전하게 HITL(사용자 개입)을 처리합니다.
- **비동기 실행**: `arun` 래퍼를 통해 무거운 에이전트 작업이 전체 파이프라인을 차단하지 않도록 합니다.

### 에러 핸들링 전략
- **에러 범주화**: 재시도 가능(네트워크/LLM) 에러와 불가능(검증 실패) 에러를 구분하여 처리합니다.
- **폴백(Fallback) 메커니즘**: `Market Agent` 실패 시 파이프라인을 중단하는 대신, 기본 휴리스틱 데이터를 사용하여 흐름을 유지합니다.

---

## 5. 향후 로드맵 제안

1.  **멀티모달 에이전트 (Multi-Modal Agents)**:
    - 경쟁사 이미지를 분석하거나 로고/컨셉 이미지를 직접 생성하는 기능 추가.
2.  **외부 도구 통합 (External Tools)**:
    - `Financial Agent`가 실시간 주식/시장 API와 연동하여 최신 데이터를 반영.
3.  **장기 기억 (Long-Term Memory)**:
    - 벡터 저장소를 활용하여 사용자의 성향("간결한 스타일 선호" 등)을 프로젝트 간에 기억.
4.  **팀 협업 모드 (Team Collaboration)**:
    - 여러 사용자가 하나의 기획 세션에서 에이전트들과 동시에 협업할 수 있는 환경 구축.
