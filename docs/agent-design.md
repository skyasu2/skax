# PlanCraft Agent - Agent ì„¤ê³„ ë¬¸ì„œ

## 1. Multi-Agent ì•„í‚¤í…ì²˜

### 1.1 ì„¤ê³„ ì² í•™

PlanCraftëŠ” **ì „ë¬¸ê°€ í˜‘ì—… ëª¨ë¸**ì„ ì±„íƒí•©ë‹ˆë‹¤. ê° AgentëŠ” íŠ¹ì • ì˜ì—­ì˜ ì „ë¬¸ê°€ë¡œì„œ ìì‹ ì˜ ì—­í• ì— ì§‘ì¤‘í•˜ë©°, ìƒíƒœ(State)ë¥¼ í†µí•´ ì •ë³´ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PlanCraftState                        â”‚
â”‚  (ëª¨ë“  Agentê°€ ì½ê³  ì“°ëŠ” ê³µìœ  ìƒíƒœ)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘           â†‘           â†‘           â†‘
        â”‚           â”‚           â”‚           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Analyzerâ”‚  â”‚Structurâ”‚  â”‚ Writer â”‚  â”‚Reviewerâ”‚
   â”‚        â”‚  â”‚   er   â”‚  â”‚        â”‚  â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ë¶„ì„ ì „ë¬¸ê°€  êµ¬ì¡° ì„¤ê³„   ì½˜í…ì¸  ì‘ì„±  í’ˆì§ˆ ê²€í† 
```

### 1.2 State ê¸°ë°˜ Memory ì„¤ê³„

ë³¸ ì‹œìŠ¤í…œì€ LangGraph Stateë¥¼ í™œìš©í•´ **Agent ê°„ íŒë‹¨ ê²°ê³¼ ë° ì¤‘ê°„ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³µìœ **í•©ë‹ˆë‹¤.

```python
PlanCraftState = {
    "user_input": "ì‚¬ìš©ì ì›ë³¸ ì…ë ¥",
    "rag_context": "RAG ê²€ìƒ‰ ê²°ê³¼ (ëˆ„ì )",
    "web_context": "ì›¹ ê²€ìƒ‰ ê²°ê³¼ (ì¡°ê±´ë¶€)",
    "analysis": "Analyzer íŒë‹¨ ê²°ê³¼",
    "structure": "Structurer ì„¤ê³„ ê²°ê³¼",
    "draft": "Writer ì‘ì„± ê²°ê³¼",
    "messages": "ëŒ€í™” íˆìŠ¤í† ë¦¬ (Memory)"
}
```

ê° AgentëŠ” ì´ì „ Agentì˜ ì¶œë ¥ì„ Stateì—ì„œ ì½ì–´ ìì‹ ì˜ ì‘ì—…ì— í™œìš©í•˜ë©°, ì´ë¥¼ í†µí•´ **ì»¨í…ìŠ¤íŠ¸ê°€ ìœ ì§€ë˜ëŠ” ì¼ê´€ëœ ê¸°íšì„œ**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### 1.3 Reasoning íë¦„ ì„¤ê³„

Agent ë‚´ë¶€ Reasoning(Chain of Thought)ì€ **ì‹œìŠ¤í…œ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•´ ì„¤ê³„ ë ˆë²¨ì—ì„œ ê´€ë¦¬**ë˜ë©°, ì‚¬ìš©ìì—ê²ŒëŠ” **êµ¬ì¡°í™”ëœ ê²°ê³¼ë§Œ ì œê³µ**í•©ë‹ˆë‹¤.

| êµ¬ë¶„ | ì²˜ë¦¬ ë°©ì‹ |
|------|-----------|
| **ë‚´ë¶€ ì¶”ë¡ ** | í”„ë¡¬í”„íŠ¸ì— CoT ë‹¨ê³„ ëª…ì‹œ â†’ LLMì´ ë‹¨ê³„ë³„ ì‚¬ê³  |
| **ì‚¬ìš©ì ì¶œë ¥** | JSON êµ¬ì¡°í™”ëœ ê²°ê³¼ë§Œ ë°˜í™˜ |
| **Reasoning ë…¸ì¶œ** | âŒ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ (ì„¤ê³„ ì›ì¹™) |

> ğŸ’¡ ì´ëŠ” ìµœì‹  LLM ê°€ì´ë“œë¼ì¸ì— ë”°ë¥¸ ê²ƒìœ¼ë¡œ, Reasoning ê³¼ì •ì˜ ì§ì ‘ ë…¸ì¶œë³´ë‹¤ êµ¬ì¡°í™”ëœ ê²°ê³¼ ì œê³µì´ ë” ì•ˆì •ì ì…ë‹ˆë‹¤.

### 1.4 Temperature ì „ëµ

| Agent | Temperature | ì´ìœ  |
|-------|-------------|------|
| Analyzer | 0.3 | ì •í™•í•œ ì •ë³´ ì¶”ì¶œ í•„ìš”, ì¼ê´€ì„± ì¤‘ìš” |
| Structurer | 0.5 | ì°½ì˜ì„±ê³¼ ë…¼ë¦¬ì„± ê· í˜• |
| Writer | 0.7 | ë‹¤ì–‘í•˜ê³  í’ë¶€í•œ í‘œí˜„ í•„ìš” |
| Reviewer | 0.3 | ì¼ê´€ëœ í‰ê°€ ê¸°ì¤€ ì ìš© |

---

## 2. Agent ìƒì„¸ ì„¤ê³„

### 2.1 Analyzer Agent

#### ì—­í• 
- ì‚¬ìš©ì ì…ë ¥ì„ ì „ë¬¸ì ìœ¼ë¡œ ë¶„ì„
- í•µì‹¬ ì •ë³´ ì¶”ì¶œ (ì£¼ì œ, ëª©ì , ëŒ€ìƒ)
- ì •ë³´ ì¶©ë¶„ì„± íŒë‹¨
- ì¶”ê°€ ì§ˆë¬¸ ìƒì„±

#### í˜ë¥´ì†Œë‚˜
> "10ë…„ ê²½ë ¥ì˜ ê¸°íš ì»¨ì„¤í„´íŠ¸"

#### Chain of Thought ì¶”ë¡  ê³¼ì •

```
Step 1: ì…ë ¥ ì´í•´
â”œâ”€â”€ ì‚¬ìš©ìê°€ ë¬´ì—‡ì„ ë§Œë“¤ê³  ì‹¶ì–´í•˜ëŠ”ê°€?
â””â”€â”€ ì–´ë–¤ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ëŠ”ê°€?

Step 2: í•µì‹¬ ìš”ì†Œ ì¶”ì¶œ
â”œâ”€â”€ ì„œë¹„ìŠ¤/ì œí’ˆì˜ ë³¸ì§ˆ
â”œâ”€â”€ íƒ€ê²Ÿ ì‚¬ìš©ì
â””â”€â”€ ì œê³µ ê°€ì¹˜

Step 3: ì •ë³´ ì¶©ë¶„ì„± íŒë‹¨
â”œâ”€â”€ ëª©í‘œ ì‚¬ìš©ì ëª…í™•ì„±
â”œâ”€â”€ í•µì‹¬ ê¸°ëŠ¥ êµ¬ì²´ì„±
â””â”€â”€ ë²”ìœ„/ì¼ì • ì •ì˜ ì—¬ë¶€

Step 4: ìµœì¢… íŒë‹¨
â”œâ”€â”€ ì¶©ë¶„ â†’ need_more_info = false
â””â”€â”€ ë¶€ì¡± â†’ ì§ˆë¬¸ 2~3ê°œ ìƒì„±
```

#### ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (Pydantic)

```python
class AnalysisResult(BaseModel):
    topic: str              # í•µì‹¬ ì£¼ì œ
    purpose: str            # ê¸°íš ëª©ì 
    target_users: str       # íƒ€ê²Ÿ ì‚¬ìš©ì
    key_features: List[str] # ì£¼ìš” ê¸°ëŠ¥
    missing_info: List[str] # ëˆ„ë½ ì •ë³´
    questions: List[str]    # ì¶”ê°€ ì§ˆë¬¸
    need_more_info: bool    # ì¶”ê°€ ì •ë³´ í•„ìš” ì—¬ë¶€
```

---

### 2.2 Structurer Agent

#### ì—­í• 
- ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ ê¸°íšì„œ êµ¬ì¡° ì„¤ê³„
- ë…¼ë¦¬ì  ì„¹ì…˜ êµ¬ì„±
- ê° ì„¹ì…˜ë³„ í•µì‹¬ í¬ì¸íŠ¸ ì •ì˜

#### í˜ë¥´ì†Œë‚˜
> "ì •ë³´ ì•„í‚¤í…íŠ¸"

#### êµ¬ì¡°í™” ì›ì¹™

```
Why â†’ What â†’ How í”„ë ˆì„ì›Œí¬

1. ì™œ (ë°°ê²½/í•„ìš”ì„±)
2. ë¬´ì—‡ì„ (ëª©í‘œ/ë²”ìœ„)
3. ì–´ë–»ê²Œ (ê¸°ëŠ¥/êµ¬í˜„)
4. ì–¸ì œ/ì–¼ë§ˆë‚˜ (ì¼ì •/ë¹„ìš©)
5. ê·¸ë˜ì„œ (ê¸°ëŒ€íš¨ê³¼)
```

#### ì¶œë ¥ ìŠ¤í‚¤ë§ˆ

```python
class StructureResult(BaseModel):
    title: str
    sections: List[Section]

class Section(BaseModel):
    id: int
    name: str
    description: str
    key_points: List[str]
```

---

### 2.3 Writer Agent

#### ì—­í• 
- êµ¬ì¡°ì— ë”°ë¼ ì‹¤ì œ ì½˜í…ì¸  ì‘ì„±
- ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
- êµ¬ì²´ì  ì˜ˆì‹œ í¬í•¨

#### í˜ë¥´ì†Œë‚˜
> "ì „ë¬¸ ì½˜í…ì¸  ë¼ì´í„°"

#### ì‘ì„± ì›ì¹™

1. **êµ¬ì²´ì„±**: ì¶”ìƒì  í‘œí˜„ ëŒ€ì‹  êµ¬ì²´ì  ìˆ˜ì¹˜/ì˜ˆì‹œ
2. **ê°€ë…ì„±**: ë¶ˆë¦¿ í¬ì¸íŠ¸, í‘œ, ì†Œì œëª© í™œìš©
3. **ì¼ê´€ì„±**: í†¤ì•¤ë§¤ë„ˆ ìœ ì§€
4. **RAG í™œìš©**: ê°€ì´ë“œ ë¬¸ì„œ ìŠ¤íƒ€ì¼ ë°˜ì˜

#### ì¶œë ¥ ìŠ¤í‚¤ë§ˆ

```python
class DraftResult(BaseModel):
    sections: List[DraftSection]

class DraftSection(BaseModel):
    id: int
    name: str
    content: str  # ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸ 
```

---

### 2.4 Reviewer Agent

#### ì—­í• 
- ì‘ì„±ëœ ê¸°íšì„œ í’ˆì§ˆ í‰ê°€
- ê°•ì /ê°œì„ ì  ë„ì¶œ
- ìµœì¢… ì ìˆ˜ ë° í”¼ë“œë°± ì œê³µ

#### í˜ë¥´ì†Œë‚˜
> "QA ì „ë¬¸ê°€"

#### í‰ê°€ ê¸°ì¤€

| í•­ëª© | ë°°ì  | í‰ê°€ ë‚´ìš© |
|------|------|-----------|
| ë…¼ë¦¬ì„± | 3ì  | ì„¹ì…˜ ê°„ íë¦„, ì¸ê³¼ê´€ê³„ |
| ëª…í™•ì„± | 3ì  | ì´í•´í•˜ê¸° ì‰¬ìš´ í‘œí˜„ |
| ì™„ì„±ë„ | 2ì  | ëˆ„ë½ ì •ë³´ ì—†ìŒ |
| ì‹¤í˜„ê°€ëŠ¥ì„± | 2ì  | í˜„ì‹¤ì ì¸ ê³„íš |

#### ì¶œë ¥ ìŠ¤í‚¤ë§ˆ

```python
class ReviewResult(BaseModel):
    overall_score: int      # 1-10ì 
    strengths: List[str]    # ê°•ì 
    improvements: List[str] # ê°œì„ ì 
    suggestions: List[str]  # ì œì•ˆì‚¬í•­
    is_ready: bool          # ì œì¶œ ì¤€ë¹„ ì—¬ë¶€
```

---

## 3. Agent ê°„ í˜‘ì—…

### 3.1 ìƒíƒœ ì „ë‹¬

```python
# Analyzer â†’ Structurer
state["analysis"] = {
    "topic": "ì ì‹¬ ë©”ë‰´ ì¶”ì²œ ì•±",
    "purpose": "ì„ íƒ ì‹œê°„ ë‹¨ì¶•",
    "target_users": "ì§ì¥ì¸",
    "key_features": ["AI ì¶”ì²œ", "íˆ¬í‘œ", "ì£¼ë¬¸"]
}

# Structurer â†’ Writer
state["structure"] = {
    "title": "ì‚¬ë‚´ ì ì‹¬ ë©”ë‰´ ì¶”ì²œ ì„œë¹„ìŠ¤ ê¸°íšì„œ",
    "sections": [
        {"id": 1, "name": "ê°œìš”", ...},
        {"id": 2, "name": "ê¸°ëŠ¥ ìƒì„¸", ...}
    ]
}

# Writer â†’ Reviewer
state["draft"] = {
    "sections": [
        {"id": 1, "name": "ê°œìš”", "content": "## ê°œìš”\n..."},
        ...
    ]
}
```

### 3.2 ì—ëŸ¬ ì²˜ë¦¬

ëª¨ë“  AgentëŠ” **Graceful Degradation** íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤:

```python
try:
    # LLM í˜¸ì¶œ ë° íŒŒì‹±
    result = parse_response(response)
except Exception as e:
    # ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´
    result = get_default_result()
    state["error"] = str(e)

# í•­ìƒ ìƒíƒœ ë°˜í™˜ (ì‹¤íŒ¨í•´ë„ ì›Œí¬í”Œë¡œìš° ê³„ì†)
return state
```

---

## 4. í”„ë¡¬í”„íŠ¸ ê´€ë¦¬

### 4.1 í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```
prompts/
â”œâ”€â”€ analyzer_prompt.py    # Analyzer ì‹œìŠ¤í…œ/ìœ ì € í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ structurer_prompt.py  # Structurer í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ writer_prompt.py      # Writer í”„ë¡¬í”„íŠ¸
â””â”€â”€ reviewer_prompt.py    # Reviewer í”„ë¡¬í”„íŠ¸
```

### 4.2 í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿

ê° Agent í”„ë¡¬í”„íŠ¸ëŠ” ë‹¤ìŒ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤:

```python
SYSTEM_PROMPT = """
## ì—­í• 
[í˜ë¥´ì†Œë‚˜ ì •ì˜]

## ì „ë¬¸ê°€ë¡œì„œì˜ ê´€ì 
[í•µì‹¬ ì§ˆë¬¸ë“¤]

## ì¶”ë¡  ê³¼ì • (Chain of Thought)
[ë‹¨ê³„ë³„ ì‚¬ê³  ê³¼ì •]

## ì¶œë ¥ í˜•ì‹
[JSON ìŠ¤í‚¤ë§ˆ]

## ì›ì¹™
[ì§€ì¼œì•¼ í•  ê·œì¹™]
"""

USER_PROMPT = """
[ì…ë ¥ ë°ì´í„°]
{user_input}

[ì»¨í…ìŠ¤íŠ¸]
{context}

[ì§€ì‹œì‚¬í•­]
ìœ„ì˜ ì¶”ë¡  ê³¼ì •ì„ ë”°ë¼ ë¶„ì„ í›„ JSONìœ¼ë¡œ ì¶œë ¥í•˜ì„¸ìš”.
"""
```

---

## 5. í™•ì¥ ê°€ì´ë“œ

### 5.1 ìƒˆ Agent ì¶”ê°€

1. `agents/new_agent.py` ìƒì„±
2. `prompts/new_agent_prompt.py` ìƒì„±
3. `utils/schemas.py`ì— ì¶œë ¥ ìŠ¤í‚¤ë§ˆ ì¶”ê°€
4. `graph/workflow.py`ì— ë…¸ë“œ ë“±ë¡
5. `graph/state.py`ì— ìƒíƒœ í•„ë“œ ì¶”ê°€

### 5.2 Agent ë™ì‘ ìˆ˜ì •

1. í•´ë‹¹ Agentì˜ í”„ë¡¬í”„íŠ¸ ìˆ˜ì • (`prompts/`)
2. Temperature ì¡°ì • (Agent í´ë˜ìŠ¤ `__init__`)
3. ì¶œë ¥ ìŠ¤í‚¤ë§ˆ ìˆ˜ì • (`utils/schemas.py`)
